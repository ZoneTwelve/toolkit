<!DOCTYPE html>
<html lang="en" >
<head>
  <meta charset="UTF-8">
  <title>CodePen - Pure CSS Code Editor</title>
  <link rel="stylesheet" href="./style.css">
  <script>
window.onload = function(){
var xhttp = new XMLHttpRequest();
  xhttp.onreadystatechange = function() {
      if (this.readyState == 4 && this.status == 200) {
         // Typical action to be performed when the document is ready:
         //document.querySelector("#code").innerText = xhttp.responseText;
      }
  };
  xhttp.open("GET", "code.js", true);
  xhttp.send();
}
  </script>
</head>
<body>
<!-- partial:index.partial.html -->
<div class="code-editor">	
			<span class="control"></span>
			<span class="control"></span>
			<span class="control"></span>
			<pre class="line-numbers"><code id="code" class="language-css">
// ==UserScript==
// @name     GoogleSearch With Keyboard
// @version  1
// @include     https://www.google.com/search*
// @include     http://www.google.com/search*
// @include     https://scholar.google.com/scholar*
// @include     http://scholar.google.com/scholar*
// ==/UserScript==



const halfHeight = window.innerHeight/2;

var pre = 0;//document.createElement("a");
var preSize = 20;
var result = [];
document.body.style.scrollBehavior = "smooth";
window.onload = function(){
	focus(0);
}
window.onkeypress = function(event){
  window.blur();
  if(document.activeElement==document.querySelector('input[type="text"]')){
     /* do nothing */
  }else if(!isNaN(parseInt(event.key,  10))){
  	focus( (parseInt( event.key, 10 ) + 9 ) % 10 )
  }else if(event.key=="Enter"){
    console.log("open");
    console.log( location.origin );

    switch(true){
      case (/scholar\.google\.com/).test(location.origin):
      	window.open( result[pre].children[1].href );
      break;
      case (/search\.google\.com/).test(location.origin):
      case (/www\.google\.com/).test(location.origin):
		   	window.open(result[pre].parentElement.href);
      break;
    }
  }else if(event.key.toLowerCase()=="n"){
    if(pre<result.length)
		  focus(pre+1);
  }else if(event.key.toLowerCase()=="p"){
    if(pre>0)
	    focus(pre-1);
  }else if(event.key.toLowerCase()=="s"){
   	document.querySelector('input[type="text"]').focus(); 
  }else if(event.key.toLowerCase()=="e"){
   	document.querySelector("#pnnext").click();
  }else if(event.key.toLowerCase()=="q"){
   	document.querySelector("#pnprev").click();
  }
  
}

function focus(opt){
    let ch = opt;
    result = document.querySelectorAll("h3:not(.r), div.related-question-pair");

    if( result[ch] ){
      //result[ch].scrollIntoView();
      let el = result[opt];
      result[pre].style.fontSize = preSize+"px";
      result[pre].style.color = "blue";
      result[ch].style.color = "red";
      preSize = ( Number(window.getComputedStyle(result[ch]).getPropertyValue('font-size').match(/\d+/)[0]) );
      result[ch].style.fontSize = `${preSize+1}px`;
      console.log( preSize );
      pre = ch

      let pos = position( result[ch] );
      window.scrollTo( { 
        top: pos[1] - halfHeight + 50, 
        behavior: "smooth" 
      } )
			console.log( result[pre] );
      //window.scrollTo(0, pos[1] - halfHeight + 50);
    }

}

function position(elem) {
    var left = 0,
        top = 0;

    do {
        left += elem.offsetLeft;
        top += elem.offsetTop;
    } while ( elem = elem.offsetParent );

    return [ left, top ];
}
</code></pre>
</div>
<!-- partial -->
  <script  src="./script.js"></script>
<!--footer>
Copy from https://codepen.io/rrenula/pen/qmaFb
</footer-->
</body>
</html>
